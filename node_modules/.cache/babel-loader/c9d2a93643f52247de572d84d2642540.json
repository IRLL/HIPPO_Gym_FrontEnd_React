{"ast":null,"code":"import _objectSpread from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import'./game.css';import{CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,ArrowRightOutlined,ReloadOutlined,UpOutlined,DownOutlined,StopOutlined,CloudUploadOutlined,CloudDownloadOutlined,SendOutlined}from'@ant-design/icons';import{Button,message,Input,Spin,Tooltip,Modal,Row,Col}from'antd';import{w3cwebsocket as W3CWebSocket}from\"websocket\";import{browserName,osName,browserVersion,osVersion}from'react-device-detect';import getKeyInput from'../utils/getKeyInput';import{WS_URL,USER_ID,PROJECT_ID}from'../utils/constants';var Game=/*#__PURE__*/function(_React$Component){_inherits(Game,_React$Component);var _super=_createSuper(Game);function Game(){var _this;_classCallCheck(this,Game);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isStart:false,frameCount:0,frameId:0,frameRate:30,frameSrc:\"\",isLoading:true,isEnd:false,isVisible:false};_this.handleOk=function(e){_this.setState({isVisible:false});_this.props.action();};_this.handleCancel=function(e){_this.setState({isVisible:false});};_this.sendMessage=function(data){if(_this.state.isLoading){message.error(\"Please wait the connection to be established first!\");return;}var allData=_objectSpread(_objectSpread({},data),{},{frameCount:_this.state.frameCount,frameId:_this.state.frameId});_this.websocket.send(JSON.stringify(allData));};return _this;}_createClass(Game,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.timer=setInterval(function(){_this2.websocket=new W3CWebSocket(WS_URL);_this2.websocket.onopen=function(){clearTimeout(_this2.timer);console.log('WebSocket Client Connected');_this2.setState({isLoading:false});_this2.sendMessage({userId:USER_ID,projectId:PROJECT_ID});};_this2.websocket.onmessage=function(message){if(message.data===\"done\"){_this2.setState({isEnd:true,isVisible:true});}else{var frame=JSON.parse(message.data).frame;_this2.setState(function(prevState){return{frameSrc:\"data:image/jpeg;base64, \"+frame,frameCount:prevState.frameCount+1,frameId:JSON.parse(message.data).frameId};});}};},30000);document.addEventListener('keydown',function(event){if([37,38,39,40].indexOf(event.keyCode)>-1){event.preventDefault();}_this2.sendMessage(getKeyInput(event.code));});document.addEventListener('mousedown',function(event){_this2.sendMessage({eventType:\"mousedown\",xCoord:event.offsetX,yCoord:event.offsetY});});}},{key:\"handleStart\",value:function handleStart(status){if(status===\"start\"){this.sendMessage({command:status,system:osName,systemVersion:osVersion,browser:browserName,browserVersion:browserVersion});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else if(status===\"stop\"||status===\"pause\"){this.sendMessage({command:status});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else{this.sendMessage({command:status});}}},{key:\"handleFPS\",value:function handleFPS(speed){if(speed===\"faster\"&&this.state.frameRate+5>90||speed===\"slower\"&&this.state.frameRate-5<1){message.error(\"Invalid FPS, the FPS can only between 1 - 90!\");}else{this.setState(function(prevState){return{frameRate:speed===\"faster\"?prevState.frameRate+5:prevState.frameRate-5};});this.sendMessage({changeFrameRate:speed});}}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,isLoading=_this$state.isLoading,frameSrc=_this$state.frameSrc,isStart=_this$state.isStart,frameRate=_this$state.frameRate,isEnd=_this$state.isEnd;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"gameWindow\"},isLoading||!frameSrc?/*#__PURE__*/React.createElement(Spin,{className:\"Loader\",size:\"large\",tip:\"The robot is about to start the game, please wait ...\"}):/*#__PURE__*/React.createElement(\"img\",{className:\"gameContent\",src:frameSrc,alt:\"frame\",width:\"700px\",height:\"600px\"})),/*#__PURE__*/React.createElement(Modal,{title:\"Game end message\",visible:this.state.isVisible,onOk:this.handleOk,onCancel:this.handleCancel},/*#__PURE__*/React.createElement(\"p\",null,\"The game has ended\"),/*#__PURE__*/React.createElement(\"p\",null,\"Press \",/*#__PURE__*/React.createElement(\"b\",null,\"Cancel\"),\" to stay on this page\"),/*#__PURE__*/React.createElement(\"p\",null,\"Press \",/*#__PURE__*/React.createElement(\"b\",null,\"OK\"),\" to move to next step\")),/*#__PURE__*/React.createElement(\"div\",{className:\"controlPanel\"},/*#__PURE__*/React.createElement(\"div\",{className:\"panelContainer\"},/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:2}),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Tooltip,{placement:\"left\",title:\"Move Up\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowUpOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedonw\",action:\"up\"});}}))),/*#__PURE__*/React.createElement(Col,{span:6},isStart?/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"danger\",icon:/*#__PURE__*/React.createElement(PauseOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"pause\");}},\"Pause\"):/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"primary\",icon:/*#__PURE__*/React.createElement(CaretRightOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"start\");}},\"Start\")),/*#__PURE__*/React.createElement(Col,{span:6},/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"danger\",icon:/*#__PURE__*/React.createElement(StopOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"stop\");}},\"Stop\")),/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"primary\",className:\"resetButton\",icon:/*#__PURE__*/React.createElement(ReloadOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"reset\");}},\"Reset\"))),/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Move Left\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowLeftOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"left\"});}}))),/*#__PURE__*/React.createElement(Col,{span:3},/*#__PURE__*/React.createElement(Tooltip,{placement:\"top\",title:\"Move Right\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowRightOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"right\"});}}))),/*#__PURE__*/React.createElement(Col,{span:6},/*#__PURE__*/React.createElement(Button,{className:\"onlineButton\",shape:\"round\",icon:/*#__PURE__*/React.createElement(CloudUploadOutlined,null),type:\"primary\",size:\"large\",onClick:function onClick(){return _this3.handleStart(\"trainOffline\");}},\"Train Online\")),/*#__PURE__*/React.createElement(Col,{span:6},/*#__PURE__*/React.createElement(Button,{className:\"offlineButton\",shape:\"round\",type:\"primary\",size:\"large\",icon:/*#__PURE__*/React.createElement(CloudDownloadOutlined,null),onClick:function onClick(){return _this3.handleStart(\"trainOnline\");}},\"Train Offline\"))),/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:2}),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Tooltip,{placement:\"right\",title:\"Move Dowm\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowDownOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"down\"});}}))),/*#__PURE__*/React.createElement(Col,{span:6},/*#__PURE__*/React.createElement(Input,{className:\"fpsInput\",defaultValue:30,value:frameRate,suffix:\"FPS\"})),/*#__PURE__*/React.createElement(Col,{span:6},/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Increase the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(UpOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"faster\");}})),/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Decrease the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(DownOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"slower\");}}))),/*#__PURE__*/React.createElement(Col,{span:4},isEnd?/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Move to next step\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{type:\"primary\",shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(SendOutlined,null),onClick:this.handleOk},\"Next\")):null)))));}}]);return Game;}(React.Component);export default Game;","map":{"version":3,"sources":["/Charlie/Dropbox/Development/IRLL/hippoGym/Front/src/components/game.js"],"names":["React","CaretRightOutlined","PauseOutlined","ArrowUpOutlined","ArrowDownOutlined","ArrowLeftOutlined","ArrowRightOutlined","ReloadOutlined","UpOutlined","DownOutlined","StopOutlined","CloudUploadOutlined","CloudDownloadOutlined","SendOutlined","Button","message","Input","Spin","Tooltip","Modal","Row","Col","w3cwebsocket","W3CWebSocket","browserName","osName","browserVersion","osVersion","getKeyInput","WS_URL","USER_ID","PROJECT_ID","Game","state","isStart","frameCount","frameId","frameRate","frameSrc","isLoading","isEnd","isVisible","handleOk","e","setState","props","action","handleCancel","sendMessage","data","error","allData","websocket","send","JSON","stringify","timer","setInterval","onopen","clearTimeout","console","log","userId","projectId","onmessage","frame","parse","prevState","document","addEventListener","event","indexOf","keyCode","preventDefault","code","eventType","xCoord","offsetX","yCoord","offsetY","status","command","system","systemVersion","browser","speed","changeFrameRate","actionType","handleStart","handleFPS","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'antd/dist/antd.css';\nimport './game.css';\nimport {CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,\n    ArrowRightOutlined, ReloadOutlined, UpOutlined, DownOutlined, StopOutlined,\n    CloudUploadOutlined,CloudDownloadOutlined, SendOutlined} from '@ant-design/icons';\nimport { Button,message, Input, Spin, Tooltip, Modal, Row, Col } from 'antd';\nimport { w3cwebsocket as W3CWebSocket } from \"websocket\";\nimport {browserName,osName,browserVersion,osVersion} from 'react-device-detect';\nimport getKeyInput from '../utils/getKeyInput';\nimport {WS_URL,USER_ID, PROJECT_ID} from '../utils/constants';\n\nclass Game extends React.Component{\n    \n    state = {\n        isStart : false,\n        frameCount : 0,\n        frameId : 0,\n        frameRate : 30,\n        frameSrc : \"\",\n        isLoading : true,\n        isEnd : false,\n        isVisible : false\n    }\n\n    componentDidMount() {\n\n        this.timer = setInterval(() => {\n            this.websocket = new W3CWebSocket(WS_URL);\n            this.websocket.onopen = () => {\n                clearTimeout(this.timer);\n                console.log('WebSocket Client Connected');\n                this.setState(({\n                    isLoading : false\n                }))\n                this.sendMessage({\n                    userId : USER_ID,\n                    projectId : PROJECT_ID\n                })\n            };\n\n            this.websocket.onmessage = (message) => {\n                if(message.data === \"done\"){\n                    this.setState(({\n                        isEnd : true,\n                        isVisible : true\n                    }))\n                }else{\n                    let frame = JSON.parse(message.data).frame;\n                    this.setState(prevState => ({\n                        frameSrc : \"data:image/jpeg;base64, \" + frame,\n                        frameCount : prevState.frameCount + 1,\n                        frameId : JSON.parse(message.data).frameId\n                    }));\n                }\n            };\n        }, 30000);\n\n        document.addEventListener('keydown', (event) => {\n            if([37, 38, 39, 40].indexOf(event.keyCode) > -1) {\n                event.preventDefault();\n            }\n            this.sendMessage(getKeyInput(event.code));\n        })\n\n        document.addEventListener('mousedown',(event) => {\n            this.sendMessage({\n                eventType : \"mousedown\",\n                xCoord : event.offsetX,\n                yCoord : event.offsetY\n            })\n        })\n    }\n\n    handleOk = e => {\n        this.setState({\n          isVisible : false\n        });\n        this.props.action()\n      };\n    \n    handleCancel = e => {\n        this.setState({\n            isVisible : false\n        });\n    };\n\n    sendMessage = (data) => {\n        if(this.state.isLoading){\n            message.error(\"Please wait the connection to be established first!\")\n            return;\n        }\n        const allData = {\n            ...data,\n            frameCount : this.state.frameCount,\n            frameId : this.state.frameId\n        }\n        this.websocket.send(JSON.stringify(allData));\n    }\n\n    handleStart(status){\n        if(status === \"start\"){\n            this.sendMessage({\n                command : status,\n                system : osName,\n                systemVersion : osVersion,\n                browser : browserName,\n                browserVersion : browserVersion,\n\n            })\n            this.setState(prevState => ({\n                isStart : !prevState.isStart\n            }))\n        }else if (status === \"stop\" || status === \"pause\"){\n            this.sendMessage({\n                command : status\n            })   \n            this.setState(prevState => ({\n                isStart : !prevState.isStart,\n            }));\n        }\n        else{\n            this.sendMessage({\n                command : status\n            })\n        }   \n    }\n\n    handleFPS(speed){\n        if((speed === \"faster\" && this.state.frameRate + 5 > 90) || (speed === \"slower\" && this.state.frameRate - 5 < 1)){\n            message.error(\"Invalid FPS, the FPS can only between 1 - 90!\")\n        }else{\n            this.setState(prevState => ({\n                frameRate : speed === \"faster\" ? prevState.frameRate + 5 : prevState.frameRate - 5\n            }))\n            this.sendMessage({\n                changeFrameRate : speed\n            })\n        }\n    }\n\n    render() {\n        const {isLoading, frameSrc, isStart, frameRate, isEnd} = this.state;\n        return (\n            <div>\n                <div className=\"gameWindow\">\n                    {isLoading || !frameSrc ?\n                    <Spin className=\"Loader\" size = \"large\" tip=\"The robot is about to start the game, please wait ...\" /> \n                    : <img className=\"gameContent\" src={frameSrc} alt=\"frame\" width=\"700px\" height=\"600px\" />\n                    }\n                </div>\n                <Modal\n                    title=\"Game end message\"\n                    visible={this.state.isVisible}\n                    onOk={this.handleOk}\n                    onCancel={this.handleCancel}\n                    >\n                    <p>The game has ended</p>\n                    <p>Press <b>Cancel</b> to stay on this page</p>\n                    <p>Press <b>OK</b> to move to next step</p>\n                </Modal>\n                \n                <div className=\"controlPanel\">\n                    <div className=\"panelContainer\">\n                    <Row gutter={[4, 8]}>\n                        <Col span={2} />\n                        <Col span={5} >\n                            <Tooltip placement=\"left\" title=\"Move Up\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowUpOutlined />} onClick={() => this.sendMessage({actionType : \"mousedonw\",action : \"up\"})}/>\n                            </Tooltip></Col>\n                        <Col span={6} >\n                        {isStart ? <Button shape=\"round\" type=\"danger\" icon={<PauseOutlined  />} size='large' onClick={() => this.handleStart(\"pause\")}>Pause</Button> \n                            : <Button shape=\"round\" type=\"primary\"  icon={<CaretRightOutlined />} size='large' onClick={() => this.handleStart(\"start\")}>Start</Button>\n                        }\n                        </Col>\n                        <Col span={6} ><Button shape=\"round\" type=\"danger\" icon={<StopOutlined  />} size='large' onClick={() => this.handleStart(\"stop\")}>Stop</Button></Col>\n                        <Col span={4} ><Button shape=\"round\" type=\"primary\" className=\"resetButton\"  icon={<ReloadOutlined />} size='large' onClick={() => this.handleStart(\"reset\")}>Reset</Button></Col>\n                    </Row>\n                    <Row gutter={[4, 8]}>\n                        <Col span={4} >\n                            <Tooltip placement=\"bottom\" title=\"Move Left\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowLeftOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\", action :\"left\"})}/>\n                            </Tooltip>\n                        </Col>\n                        <Col span={3} >\n                            <Tooltip placement=\"top\" title=\"Move Right\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowRightOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\" , action : \"right\"})}/>\n                            </Tooltip></Col>\n                        <Col span={6} ><Button className=\"onlineButton\" shape=\"round\" icon={<CloudUploadOutlined />} type=\"primary\" size='large' onClick={() => this.handleStart(\"trainOffline\")}>Train Online</Button></Col>\n                        <Col span={6} ><Button className=\"offlineButton\" shape=\"round\" type=\"primary\" size='large' icon={<CloudDownloadOutlined />} onClick={() => this.handleStart(\"trainOnline\")}>Train Offline</Button></Col>\n                    </Row>\n                    <Row gutter={[4,8]}>\n                        <Col span={2} />\n                        <Col span={5} >\n                            <Tooltip placement=\"right\" title=\"Move Dowm\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowDownOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\",action : \"down\"})}/>\n                            </Tooltip></Col>\n                            <Col span={6}><Input className=\"fpsInput\" defaultValue={30} value={frameRate} suffix=\"FPS\"/></Col>\n                            <Col span={6}>\n                                <Tooltip placement=\"bottom\" title=\"Increase the FPS\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<UpOutlined />} onClick={() => this.handleFPS(\"faster\")}/>\n                                </Tooltip>\n                                <Tooltip placement=\"bottom\" title=\"Decrease the FPS\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<DownOutlined />} onClick={() => this.handleFPS(\"slower\")}/>\n                                </Tooltip>\n                            </Col>\n                            <Col span={4}>\n                                {isEnd ? <Tooltip placement=\"bottom\" title=\"Move to next step\" arrowPointAtCenter>\n                                            <Button type=\"primary\" shape=\"round\" size=\"large\" icon={<SendOutlined />} onClick={this.handleOk}>Next</Button>\n                                        </Tooltip> : null}\n                            </Col>\n                    </Row>\n                    </div>\n                </div>\n            </div>\n        )}\n}\n\nexport default Game;"]},"metadata":{},"sourceType":"module"}