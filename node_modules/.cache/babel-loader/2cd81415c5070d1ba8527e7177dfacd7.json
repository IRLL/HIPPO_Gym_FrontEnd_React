{"ast":null,"code":"import _objectSpread from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import'./game.css';import{CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,ArrowRightOutlined,ReloadOutlined,UpOutlined,DownOutlined,StopOutlined,CloudUploadOutlined,CloudDownloadOutlined,SendOutlined}from'@ant-design/icons';import{Button,message,Input,Spin,Tooltip,Modal,Row,Col}from'antd';import{w3cwebsocket as W3CWebSocket}from\"websocket\";import{browserName,osName,browserVersion,osVersion}from'react-device-detect';import getKeyInput from'../utils/getKeyInput';import{WS_URL,USER_ID,PROJECT_ID}from'../utils/constants';var Game=/*#__PURE__*/function(_React$Component){_inherits(Game,_React$Component);var _super=_createSuper(Game);function Game(){var _this;_classCallCheck(this,Game);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isStart:false,frameCount:0,frameId:0,frameRate:30,frameSrc:\"\",isLoading:true,isEnd:false,isVisible:false,UIlist:[]};_this.handleOk=function(e){_this.setState({isVisible:false});_this.props.action();};_this.handleCancel=function(e){_this.setState({isVisible:false});};_this.sendMessage=function(data){var allData=_objectSpread(_objectSpread({},data),{},{frameCount:_this.state.frameCount,frameId:_this.state.frameId});_this.websocket.send(JSON.stringify(allData));};return _this;}_createClass(Game,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;//To ensure the websocket server is ready to connect\n//we try to connect the webscoket server periodically\n//for every 30 seconds until the connection has been established\nthis.timer=setInterval(function(){//connect the websocket server\n_this2.websocket=new W3CWebSocket(WS_URL);_this2.websocket.onopen=function(){clearTimeout(_this2.timer);console.log('WebSocket Client Connected');_this2.setState({isLoading:false});_this2.sendMessage({userId:USER_ID,projectId:PROJECT_ID});};//listen to the data from the websocket server\n_this2.websocket.onmessage=function(message){//\"done\" means the game has ended\nif(message.data===\"done\"){_this2.setState({isEnd:true,isVisible:true});//parse the data from the websocket server\n}else{var parsedData=JSON.parse(message.data);if(parsedData.UI){_this2.setState({UIlist:parsedData.UI});}if(parsedData.frame){var frame=parsedData.frame;var frameId=parsedData.frameId;_this2.setState(function(prevState){return{frameSrc:\"data:image/jpeg;base64, \"+frame,frameCount:prevState.frameCount+1,frameId:frameId};});}}};//listen to the websocket closing status\n_this2.websocket.onclose=function(){console.log('WebSocket Client Closed');_this2.setState({isEnd:true,isVisible:true});};},30000);//listen to the user's keyboard inputs\ndocument.addEventListener('keydown',function(event){if([37,38,39,40].indexOf(event.keyCode)>-1){event.preventDefault();}_this2.sendMessage(getKeyInput(event.code));});}//change the confirmation modal to be invisible\n//navigate to the post-game page\n},{key:\"handleCommand\",//send game control commands to the websocket server\nvalue:function handleCommand(status){if(this.state.isLoading){message.error(\"Please wait the connection to be established first!\");return;}if(status===\"start\"){this.sendMessage({command:status,system:osName,systemVersion:osVersion,browser:browserName,browserVersion:browserVersion});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else if(status===\"stop\"||status===\"pause\"){this.sendMessage({command:status});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else{this.sendMessage({command:status});}}//chnage the FPS of the game\n},{key:\"handleFPS\",value:function handleFPS(speed){if(speed===\"faster\"&&this.state.frameRate+5>90||speed===\"slower\"&&this.state.frameRate-5<1){message.error(\"Invalid FPS, the FPS can only between 1 - 90!\");}else{this.setState(function(prevState){return{frameRate:speed===\"faster\"?prevState.frameRate+5:prevState.frameRate-5};});this.sendMessage({changeFrameRate:speed});}}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,isLoading=_this$state.isLoading,frameSrc=_this$state.frameSrc,isStart=_this$state.isStart,frameRate=_this$state.frameRate,isEnd=_this$state.isEnd;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"gameWindow\"},isLoading||!frameSrc?/*#__PURE__*/React.createElement(Spin,{className:\"Loader\",size:\"large\",tip:\"The robot is about to start the game, please wait ...\"}):/*#__PURE__*/React.createElement(\"img\",{className:\"gameContent\",src:frameSrc,alt:\"frame\",width:\"700px\",height:\"600px\"})),/*#__PURE__*/React.createElement(Modal,{title:\"Game end message\",visible:this.state.isVisible,onOk:this.handleOk,onCancel:this.handleCancel},/*#__PURE__*/React.createElement(\"p\",null,\"The game has ended\"),/*#__PURE__*/React.createElement(\"p\",null,\"Press \",/*#__PURE__*/React.createElement(\"b\",null,\"Cancel\"),\" to stay on this page\"),/*#__PURE__*/React.createElement(\"p\",null,\"Press \",/*#__PURE__*/React.createElement(\"b\",null,\"OK\"),\" to move to next step\")),/*#__PURE__*/React.createElement(\"div\",{className:\"controlPanel\"},/*#__PURE__*/React.createElement(\"div\",{className:\"panelContainer\"},/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:2}),/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Tooltip,{placement:\"left\",title:\"Move Up\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowUpOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedonw\",action:\"up\"});}}))),/*#__PURE__*/React.createElement(Col,{span:5},isStart?/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"danger\",icon:/*#__PURE__*/React.createElement(PauseOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleCommand(\"pause\");}},\"Pause\"):/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"primary\",icon:/*#__PURE__*/React.createElement(CaretRightOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleCommand(\"start\");}},\"Start\")),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"danger\",icon:/*#__PURE__*/React.createElement(StopOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleCommand(\"stop\");}},\"Stop\")),/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Button,{shape:\"round\",type:\"primary\",className:\"resetButton\",icon:/*#__PURE__*/React.createElement(ReloadOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleCommand(\"reset\");}},\"Reset\")),/*#__PURE__*/React.createElement(Col,{span:2},/*#__PURE__*/React.createElement(Button,{className:\"badButton\",shape:\"round\",type:\"primary\",size:\"large\",icon:/*#__PURE__*/React.createElement(CloudDownloadOutlined,null),onClick:function onClick(){return _this3.handleCommand(\"bad\");}},\"Bad\"))),/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Move Left\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowLeftOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"left\"});}}))),/*#__PURE__*/React.createElement(Col,{span:2},/*#__PURE__*/React.createElement(Tooltip,{placement:\"top\",title:\"Move Right\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowRightOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"right\"});}}))),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Button,{className:\"onlineButton\",shape:\"round\",icon:/*#__PURE__*/React.createElement(CloudUploadOutlined,null),type:\"primary\",size:\"large\",onClick:function onClick(){return _this3.handleCommand(\"trainOnline\");}},\"Train Online\")),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Button,{className:\"offlineButton\",shape:\"round\",type:\"primary\",size:\"large\",icon:/*#__PURE__*/React.createElement(CloudDownloadOutlined,null),onClick:function onClick(){return _this3.handleCommand(\"trainOffline\");}},\"Train Offline\")),/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Button,{className:\"goodButton\",shape:\"round\",type:\"primary\",size:\"large\",icon:/*#__PURE__*/React.createElement(CloudDownloadOutlined,null),onClick:function onClick(){return _this3.handleCommand(\"good\");}},\"Good\")),\"                    \"),/*#__PURE__*/React.createElement(Row,{gutter:[4,8]},/*#__PURE__*/React.createElement(Col,{span:2}),/*#__PURE__*/React.createElement(Col,{span:4},/*#__PURE__*/React.createElement(Tooltip,{placement:\"right\",title:\"Move Down\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowDownOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"down\"});}}))),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Input,{className:\"fpsInput\",defaultValue:30,value:frameRate,suffix:\"FPS\"})),/*#__PURE__*/React.createElement(Col,{span:5},/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Increase the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(UpOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"faster\");}})),/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Decrease the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(DownOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"slower\");}}))),/*#__PURE__*/React.createElement(Col,{span:4},isEnd?/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Move to next step\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{type:\"primary\",shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(SendOutlined,null),onClick:this.handleOk},\"Next\")):null)))));}}]);return Game;}(React.Component);export default Game;","map":{"version":3,"sources":["/Charlie/Dropbox/Development/IRLL/hippoGym/Front/src/components/game.js"],"names":["React","CaretRightOutlined","PauseOutlined","ArrowUpOutlined","ArrowDownOutlined","ArrowLeftOutlined","ArrowRightOutlined","ReloadOutlined","UpOutlined","DownOutlined","StopOutlined","CloudUploadOutlined","CloudDownloadOutlined","SendOutlined","Button","message","Input","Spin","Tooltip","Modal","Row","Col","w3cwebsocket","W3CWebSocket","browserName","osName","browserVersion","osVersion","getKeyInput","WS_URL","USER_ID","PROJECT_ID","Game","state","isStart","frameCount","frameId","frameRate","frameSrc","isLoading","isEnd","isVisible","UIlist","handleOk","e","setState","props","action","handleCancel","sendMessage","data","allData","websocket","send","JSON","stringify","timer","setInterval","onopen","clearTimeout","console","log","userId","projectId","onmessage","parsedData","parse","UI","frame","prevState","onclose","document","addEventListener","event","indexOf","keyCode","preventDefault","code","status","error","command","system","systemVersion","browser","speed","changeFrameRate","actionType","handleCommand","handleFPS","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'antd/dist/antd.css';\nimport './game.css';\nimport {CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,\n    ArrowRightOutlined, ReloadOutlined, UpOutlined, DownOutlined, StopOutlined,\n    CloudUploadOutlined,CloudDownloadOutlined, SendOutlined} from '@ant-design/icons';\nimport { Button,message, Input, Spin, Tooltip, Modal, Row, Col } from 'antd';\nimport { w3cwebsocket as W3CWebSocket } from \"websocket\";\nimport {browserName,osName,browserVersion,osVersion} from 'react-device-detect';\nimport getKeyInput from '../utils/getKeyInput';\nimport {WS_URL,USER_ID, PROJECT_ID} from '../utils/constants';\n\nclass Game extends React.Component{\n    \n    state = {\n        isStart : false,\n        frameCount : 0,\n        frameId : 0,\n        frameRate : 30,\n        frameSrc : \"\",\n        isLoading : true,\n        isEnd : false,\n        isVisible : false,\n        UIlist : []\n    }\n\n    componentDidMount() {\n\n        //To ensure the websocket server is ready to connect\n        //we try to connect the webscoket server periodically\n        //for every 30 seconds until the connection has been established\n        this.timer = setInterval(() => {\n            //connect the websocket server\n            this.websocket = new W3CWebSocket(WS_URL);\n            this.websocket.onopen = () => {\n                clearTimeout(this.timer);\n                console.log('WebSocket Client Connected');\n                this.setState(({\n                    isLoading : false\n                }))\n                this.sendMessage({\n                    userId : USER_ID,\n                    projectId : PROJECT_ID\n                })\n            };\n\n            //listen to the data from the websocket server\n            this.websocket.onmessage = (message) => {\n                //\"done\" means the game has ended\n                if(message.data === \"done\"){\n                    this.setState(({\n                        isEnd : true,\n                        isVisible : true\n                    }))\n                //parse the data from the websocket server\n                }else{\n                    let parsedData = JSON.parse(message.data);\n                    if(parsedData.UI){\n                        this.setState(({\n                            UIlist : parsedData.UI\n                        }))\n                    }\n                    if(parsedData.frame){\n                        let frame = parsedData.frame;\n                        let frameId = parsedData.frameId;\n                        this.setState(prevState => ({\n                            frameSrc : \"data:image/jpeg;base64, \" + frame,\n                            frameCount : prevState.frameCount + 1,\n                            frameId : frameId\n                        }));\n                    }\n                }\n            };\n\n            //listen to the websocket closing status\n            this.websocket.onclose = () => {\n                console.log('WebSocket Client Closed');\n                this.setState(({\n                    isEnd : true,\n                    isVisible : true\n                }))\n            }\n        }, 30000);\n\n        //listen to the user's keyboard inputs\n        document.addEventListener('keydown', (event) => {\n            if([37, 38, 39, 40].indexOf(event.keyCode) > -1) {\n                event.preventDefault();\n            }\n            this.sendMessage(getKeyInput(event.code));\n        })\n    }\n\n    //change the confirmation modal to be invisible\n    //navigate to the post-game page\n    handleOk = e => {\n        this.setState({\n          isVisible : false\n        });\n        this.props.action()\n      };\n    \n    //change the confirmation modal to be invisible\n    //stay on the game page\n    handleCancel = e => {\n        this.setState({\n            isVisible : false\n        });\n    };\n\n    //send data to websocket server in JSON format\n    sendMessage = (data) => {\n        const allData = {\n            ...data,\n            frameCount : this.state.frameCount,\n            frameId : this.state.frameId\n        }\n        this.websocket.send(JSON.stringify(allData));\n    }\n\n    //send game control commands to the websocket server\n    handleCommand(status){\n        if(this.state.isLoading){\n            message.error(\"Please wait the connection to be established first!\")\n            return;\n        }\n        if(status === \"start\"){\n            this.sendMessage({\n                command : status,\n                system : osName,\n                systemVersion : osVersion,\n                browser : browserName,\n                browserVersion : browserVersion,\n            })\n            this.setState(prevState => ({\n                isStart : !prevState.isStart\n            }))\n        }else if (status === \"stop\" || status === \"pause\"){\n            this.sendMessage({\n                command : status\n            })   \n            this.setState(prevState => ({\n                isStart : !prevState.isStart,\n            }));\n        }\n        else{\n            this.sendMessage({\n                command : status\n            })\n        }   \n    }\n\n    //chnage the FPS of the game\n    handleFPS(speed){\n        if((speed === \"faster\" && this.state.frameRate + 5 > 90) || (speed === \"slower\" && this.state.frameRate - 5 < 1)){\n            message.error(\"Invalid FPS, the FPS can only between 1 - 90!\")\n        }else{\n            this.setState(prevState => ({\n                frameRate : speed === \"faster\" ? prevState.frameRate + 5 : prevState.frameRate - 5\n            }))\n            this.sendMessage({\n                changeFrameRate : speed\n            })\n        }\n    }\n\n    render() {\n        const {isLoading, frameSrc, isStart, frameRate, isEnd} = this.state;\n        return (\n            <div>\n                <div className=\"gameWindow\">\n                    {isLoading || !frameSrc ?\n                    <Spin className=\"Loader\" size = \"large\" tip=\"The robot is about to start the game, please wait ...\" /> \n                    : <img className=\"gameContent\" src={frameSrc} alt=\"frame\" width=\"700px\" height=\"600px\" />\n                    }\n                </div>\n                <Modal\n                    title=\"Game end message\"\n                    visible={this.state.isVisible}\n                    onOk={this.handleOk}\n                    onCancel={this.handleCancel}\n                    >\n                    <p>The game has ended</p>\n                    <p>Press <b>Cancel</b> to stay on this page</p>\n                    <p>Press <b>OK</b> to move to next step</p>\n                </Modal>\n                \n                <div className=\"controlPanel\">\n                    <div className=\"panelContainer\">\n                    <Row gutter={[4, 8]}>\n                        <Col span={2} />\n                        <Col span={4} >\n                            <Tooltip placement=\"left\" title=\"Move Up\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowUpOutlined />} onClick={() => this.sendMessage({actionType : \"mousedonw\",action : \"up\"})}/>\n                            </Tooltip></Col>\n                        <Col span={5} >\n                        {isStart ? <Button shape=\"round\" type=\"danger\" icon={<PauseOutlined  />} size='large' onClick={() => this.handleCommand(\"pause\")}>Pause</Button> \n                            : <Button shape=\"round\" type=\"primary\"  icon={<CaretRightOutlined />} size='large' onClick={() => this.handleCommand(\"start\")}>Start</Button>\n                        }\n                        </Col>\n                        <Col span={5} ><Button shape=\"round\" type=\"danger\" icon={<StopOutlined  />} size='large' onClick={() => this.handleCommand(\"stop\")}>Stop</Button></Col>\n                        <Col span={4} ><Button shape=\"round\" type=\"primary\" className=\"resetButton\"  icon={<ReloadOutlined />} size='large' onClick={() => this.handleCommand(\"reset\")}>Reset</Button></Col>\n                        <Col span={2} ><Button className=\"badButton\" shape=\"round\" type=\"primary\" size='large' icon={<CloudDownloadOutlined />} onClick={() => this.handleCommand(\"bad\")}>Bad</Button></Col>\n                    </Row>\n                    <Row gutter={[4, 8]}>\n                        <Col span={4} >\n                            <Tooltip placement=\"bottom\" title=\"Move Left\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowLeftOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\", action :\"left\"})}/>\n                            </Tooltip>\n                        </Col>\n                        <Col span={2} >\n                            <Tooltip placement=\"top\" title=\"Move Right\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowRightOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\" , action : \"right\"})}/>\n                            </Tooltip></Col>\n                        <Col span={5} ><Button className=\"onlineButton\" shape=\"round\" icon={<CloudUploadOutlined />} type=\"primary\" size='large' onClick={() => this.handleCommand(\"trainOnline\")}>Train Online</Button></Col>\n                        <Col span={5} ><Button className=\"offlineButton\" shape=\"round\" type=\"primary\" size='large' icon={<CloudDownloadOutlined />} onClick={() => this.handleCommand(\"trainOffline\")}>Train Offline</Button></Col>\n                        <Col span={4} ><Button className=\"goodButton\" shape=\"round\" type=\"primary\" size='large' icon={<CloudDownloadOutlined />} onClick={() => this.handleCommand(\"good\")}>Good</Button></Col>                    </Row>\n                    <Row gutter={[4,8]}>\n                        <Col span={2} />\n                        <Col span={4} >\n                            <Tooltip placement=\"right\" title=\"Move Down\" arrowPointAtCenter>\n                                <Button shape=\"round\" size=\"large\" icon={<ArrowDownOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\",action : \"down\"})}/>\n                            </Tooltip></Col>\n                            <Col span={5}><Input className=\"fpsInput\" defaultValue={30} value={frameRate} suffix=\"FPS\"/></Col>\n                            <Col span={5}>\n                                <Tooltip placement=\"bottom\" title=\"Increase the FPS\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<UpOutlined />} onClick={() => this.handleFPS(\"faster\")}/>\n                                </Tooltip>\n                                <Tooltip placement=\"bottom\" title=\"Decrease the FPS\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<DownOutlined />} onClick={() => this.handleFPS(\"slower\")}/>\n                                </Tooltip>\n                            </Col>\n                            <Col span={4}>\n                                {isEnd ? <Tooltip placement=\"bottom\" title=\"Move to next step\" arrowPointAtCenter>\n                                            <Button type=\"primary\" shape=\"round\" size=\"large\" icon={<SendOutlined />} onClick={this.handleOk}>Next</Button>\n                                        </Tooltip> : null}\n                            </Col>\n                    </Row>\n                    </div>\n                </div>\n            </div>\n        )}\n}\n\nexport default Game;"]},"metadata":{},"sourceType":"module"}