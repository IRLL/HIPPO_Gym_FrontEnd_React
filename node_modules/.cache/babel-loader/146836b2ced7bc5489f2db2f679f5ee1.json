{"ast":null,"code":"import _objectSpread from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Charlie/Dropbox/Development/IRLL/hippoGym/Front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import'./game.css';import{CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,ArrowRightOutlined,ReloadOutlined,UpOutlined,DownOutlined,StopOutlined,CloudUploadOutlined,CloudDownloadOutlined}from'@ant-design/icons';import{Button,message,Input,Spin,Tooltip}from'antd';import{w3cwebsocket as W3CWebSocket}from\"websocket\";import{browserName,osName,browserVersion,osVersion}from'react-device-detect';import getKeyInput from'../utils/getKeyInput';import{WS_URL,USER_ID}from'../utils/constants';var Game=/*#__PURE__*/function(_React$Component){_inherits(Game,_React$Component);var _super=_createSuper(Game);function Game(){var _this;_classCallCheck(this,Game);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={isStart:false,frameCount:0,frameId:0,frameRate:30,frameSrc:\"\",isLoading:true};_this.sendMessage=function(data){if(_this.state.isLoading){message.error(\"Please wait the connection to be established first!\");return;}var allData=_objectSpread(_objectSpread({},data),{},{frameCount:_this.state.frameCount,frameId:_this.state.frameId});_this.websocket.send(JSON.stringify(allData));};return _this;}_createClass(Game,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.websocket=new W3CWebSocket(WS_URL);this.timer=setInterval(function(){if(_this2.websocket.readyState!==1){_this2.websocket=new W3CWebSocket(WS_URL);}},3000);this.websocket.onopen=function(){console.log('WebSocket Client Connected');if(_this2.timer!=null){clearInterval(_this2.timer);}_this2.setState({isLoading:false});_this2.sendMessage({userId:USER_ID});};this.websocket.onmessage=function(message){if(message.data!='done'){var frame=JSON.parse(message.data).frame;_this2.setState(function(prevState){return{frameSrc:\"data:image/jpeg;base64, \"+frame,frameCount:prevState.frameCount+1,frameId:JSON.parse(message.data).frameId};});}};this.websocket.onclose=function(){console.log(\"WebSocket Client Closed\");};document.addEventListener('keydown',function(event){if([37,38,39,40].indexOf(event.keyCode)>-1){event.preventDefault();}_this2.sendMessage(getKeyInput(event.code));});document.addEventListener('mousedown',function(event){_this2.sendMessage({eventType:\"mousedown\",xCoord:event.offsetX,yCoord:event.offsetY});});}},{key:\"handleStart\",value:function handleStart(status){if(status===\"start\"){this.sendMessage({command:status,system:osName,systemVersion:osVersion,browser:browserName,browserVersion:browserVersion});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else if(status===\"stop\"||status===\"pause\"){this.sendMessage({command:status});this.setState(function(prevState){return{isStart:!prevState.isStart};});}else{this.sendMessage({command:status});}}},{key:\"handleFPS\",value:function handleFPS(speed){if(speed===\"faster\"&&this.state.frameRate+5>90||speed===\"slower\"&&this.state.frameRate-5<1){message.error(\"Invalid FPS, the FPS can only between 1 - 90!\");}else{this.setState(function(prevState){return{frameRate:speed===\"faster\"?prevState.frameRate+5:prevState.frameRate-5};});this.sendMessage({changeFrameRate:speed});}}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,isLoading=_this$state.isLoading,frameSrc=_this$state.frameSrc,isStart=_this$state.isStart,frameRate=_this$state.frameRate;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"gameWindow\"},isLoading||!frameSrc?/*#__PURE__*/React.createElement(Spin,{className:\"Loader\",size:\"large\",tip:\"The game is still loading, please wait ...\"}):/*#__PURE__*/React.createElement(\"img\",{className:\"gameContent\",src:frameSrc,alt:\"frame\",width:\"700px\",height:\"600px\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"controlPanel\"},/*#__PURE__*/React.createElement(\"table\",{className:\"panelContainer\",cellSpacing:\"0\",cellPadding:\"6\"},/*#__PURE__*/React.createElement(\"tbody\",null,/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Tooltip,{placement:\"left\",title:\"Move Up\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowUpOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedonw\",action:\"up\"});}}))),/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(\"p\",null)),/*#__PURE__*/React.createElement(\"td\",null,isStart?/*#__PURE__*/React.createElement(Button,{type:\"danger\",icon:/*#__PURE__*/React.createElement(PauseOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"pause\");}},\"Pause\"):/*#__PURE__*/React.createElement(Button,{type:\"primary\",icon:/*#__PURE__*/React.createElement(CaretRightOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"start\");}},\"Start\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Button,{type:\"danger\",icon:/*#__PURE__*/React.createElement(StopOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"stop\");}},\"Stop\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",className:\"resetButton\",icon:/*#__PURE__*/React.createElement(ReloadOutlined,null),size:\"large\",onClick:function onClick(){return _this3.handleStart(\"reset\");}},\"Reset\"))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Move Left\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowLeftOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"left\"});}}))),/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Tooltip,{placement:\"top\",title:\"Move Right\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowRightOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"right\"});}}))),/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Button,{className:\"onlineButton\",icon:/*#__PURE__*/React.createElement(CloudUploadOutlined,null),type:\"primary\",size:\"large\",onClick:function onClick(){return _this3.handleStart(\"trainOffline\");}},\"Train Online\")),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Button,{className:\"offlineButton\",type:\"primary\",size:\"large\",icon:/*#__PURE__*/React.createElement(CloudDownloadOutlined,null),onClick:function onClick(){return _this3.handleStart(\"trainOnline\");}},\"Train Offline\"))),/*#__PURE__*/React.createElement(\"tr\",null,/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Tooltip,{placement:\"right\",title:\"Move Dowm\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(ArrowDownOutlined,null),onClick:function onClick(){return _this3.sendMessage({actionType:\"mousedown\",action:\"down\"});}}))),/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Input,{className:\"fpsInput\",defaultValue:30,value:frameRate,suffix:\"FPS\"})),/*#__PURE__*/React.createElement(\"td\",null,/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Increase the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(UpOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"faster\");}})),/*#__PURE__*/React.createElement(Tooltip,{placement:\"bottom\",title:\"Decrease the FPS\",arrowPointAtCenter:true},/*#__PURE__*/React.createElement(Button,{shape:\"round\",size:\"large\",icon:/*#__PURE__*/React.createElement(DownOutlined,null),onClick:function onClick(){return _this3.handleFPS(\"slower\");}}))))))));}}]);return Game;}(React.Component);export default Game;","map":{"version":3,"sources":["/Charlie/Dropbox/Development/IRLL/hippoGym/Front/src/components/game.js"],"names":["React","CaretRightOutlined","PauseOutlined","ArrowUpOutlined","ArrowDownOutlined","ArrowLeftOutlined","ArrowRightOutlined","ReloadOutlined","UpOutlined","DownOutlined","StopOutlined","CloudUploadOutlined","CloudDownloadOutlined","Button","message","Input","Spin","Tooltip","w3cwebsocket","W3CWebSocket","browserName","osName","browserVersion","osVersion","getKeyInput","WS_URL","USER_ID","Game","state","isStart","frameCount","frameId","frameRate","frameSrc","isLoading","sendMessage","data","error","allData","websocket","send","JSON","stringify","timer","setInterval","readyState","onopen","console","log","clearInterval","setState","userId","onmessage","frame","parse","prevState","onclose","document","addEventListener","event","indexOf","keyCode","preventDefault","code","eventType","xCoord","offsetX","yCoord","offsetY","status","command","system","systemVersion","browser","speed","changeFrameRate","actionType","action","handleStart","handleFPS","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport 'antd/dist/antd.css';\nimport './game.css';\nimport {CaretRightOutlined,PauseOutlined,ArrowUpOutlined,ArrowDownOutlined,ArrowLeftOutlined,\n    ArrowRightOutlined, ReloadOutlined, UpOutlined, DownOutlined, StopOutlined,\n    CloudUploadOutlined,CloudDownloadOutlined} from '@ant-design/icons';\nimport { Button,message, Input, Spin, Tooltip } from 'antd';\nimport { w3cwebsocket as W3CWebSocket } from \"websocket\";\nimport {browserName,osName,browserVersion,osVersion} from 'react-device-detect';\nimport getKeyInput from '../utils/getKeyInput';\nimport {WS_URL, USER_ID} from '../utils/constants';\n\n\nclass Game extends React.Component{\n    \n    state = {\n        isStart : false,\n        frameCount : 0,\n        frameId : 0,\n        frameRate : 30,\n        frameSrc : \"\",\n        isLoading : true,\n    }\n\n    componentDidMount() {\n        this.websocket = new W3CWebSocket(WS_URL);\n        this.timer = setInterval(() => {\n            if (this.websocket.readyState !== 1) {\n                this.websocket = new W3CWebSocket(WS_URL);\n            }\n         }, 3000);\n\n        this.websocket.onopen = () => {\n            console.log('WebSocket Client Connected');\n            if(this.timer != null){\n                clearInterval(this.timer);\n            }\n            this.setState(({\n                isLoading : false\n            }))\n            this.sendMessage({\n                userId : USER_ID\n            })\n        };\n\n        this.websocket.onmessage = (message) => {\n            if (message.data != 'done') { \n            let frame = JSON.parse(message.data).frame;\n            this.setState(prevState => ({\n                frameSrc : \"data:image/jpeg;base64, \" + frame,\n                frameCount : prevState.frameCount + 1,\n                frameId : JSON.parse(message.data).frameId\n              }));\n        }};\n\n        this.websocket.onclose = () => {\n            console.log(\"WebSocket Client Closed\");\n        }\n\n        document.addEventListener('keydown', (event) => {\n            if([37, 38, 39, 40].indexOf(event.keyCode) > -1) {\n                event.preventDefault();\n            }\n            this.sendMessage(getKeyInput(event.code));\n        })\n\n        document.addEventListener('mousedown',(event) => {\n            this.sendMessage({\n                eventType : \"mousedown\",\n                xCoord : event.offsetX,\n                yCoord : event.offsetY\n            })\n        })\n    }\n\n    sendMessage = (data) => {\n        if(this.state.isLoading){\n            message.error(\"Please wait the connection to be established first!\")\n            return;\n        }\n        const allData = {\n            ...data,\n            frameCount : this.state.frameCount,\n            frameId : this.state.frameId\n        }\n        this.websocket.send(JSON.stringify(allData));\n    }\n\n    handleStart(status){\n        if(status === \"start\"){\n            this.sendMessage({\n                command : status,\n                system : osName,\n                systemVersion : osVersion,\n                browser : browserName,\n                browserVersion : browserVersion,\n\n            })\n            this.setState(prevState => ({\n                isStart : !prevState.isStart\n            }))\n        }else if (status === \"stop\" || status === \"pause\"){\n            this.sendMessage({\n                command : status\n            })   \n            this.setState(prevState => ({\n                isStart : !prevState.isStart,\n            }));\n        }\n        else{\n            this.sendMessage({\n                command : status\n            })\n        }   \n    }\n\n    handleFPS(speed){\n        if((speed === \"faster\" && this.state.frameRate + 5 > 90) || (speed === \"slower\" && this.state.frameRate - 5 < 1)){\n            message.error(\"Invalid FPS, the FPS can only between 1 - 90!\")\n        }else{\n            this.setState(prevState => ({\n                frameRate : speed === \"faster\" ? prevState.frameRate + 5 : prevState.frameRate - 5\n            }))\n            this.sendMessage({\n                changeFrameRate : speed\n            })\n        }\n    }\n\n    render() {\n        const {isLoading, frameSrc, isStart, frameRate} = this.state;\n        return (\n            <div>\n                <div className=\"gameWindow\">\n                    {isLoading || !frameSrc ?\n                    <Spin className=\"Loader\" size = \"large\" tip=\"The game is still loading, please wait ...\" /> \n                    : <img className=\"gameContent\" src={frameSrc} alt=\"frame\" width=\"700px\" height=\"600px\" />\n                    }\n                </div>\n\n                <div className=\"controlPanel\">\n                    <table className=\"panelContainer\" cellSpacing=\"0\" cellPadding=\"6\">\n                        <tbody>\n                            <tr>\n                                <td></td>\n                                <td>\n                                <Tooltip placement=\"left\" title=\"Move Up\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<ArrowUpOutlined />} onClick={() => this.sendMessage({actionType : \"mousedonw\",action : \"up\"})}/>\n                                </Tooltip>   \n                                </td>\n                                <td></td>\n                                <td><p></p></td>\n                                <td>{\n                                isStart ? <Button type=\"danger\" icon={<PauseOutlined  />} size='large' onClick={() => this.handleStart(\"pause\")}>Pause</Button> \n                                : <Button type=\"primary\"  icon={<CaretRightOutlined />} size='large' onClick={() => this.handleStart(\"start\")}>Start</Button>\n                                }</td>\n                                <td><Button type=\"danger\" icon={<StopOutlined  />} size='large' onClick={() => this.handleStart(\"stop\")}>Stop</Button></td>\n                                <td><Button type=\"primary\" className=\"resetButton\"  icon={<ReloadOutlined />} size='large' onClick={() => this.handleStart(\"reset\")}>Reset</Button></td>\n                            </tr>\n                            <tr>\n                                <td>\n                                <Tooltip placement=\"bottom\" title=\"Move Left\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<ArrowLeftOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\", action :\"left\"})}/>\n                                </Tooltip>\n                                </td>\n                                <td></td>\n                                <td>\n                                <Tooltip placement=\"top\" title=\"Move Right\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<ArrowRightOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\" , action : \"right\"})}/>\n                                </Tooltip>\n                                </td>\n                                <td></td>\n                                <td><Button className=\"onlineButton\" icon={<CloudUploadOutlined />} type=\"primary\" size='large' onClick={() => this.handleStart(\"trainOffline\")}>Train Online</Button></td>\n                                <td><Button className=\"offlineButton\" type=\"primary\" size='large' icon={<CloudDownloadOutlined />} onClick={() => this.handleStart(\"trainOnline\")}>Train Offline</Button></td>\n                            </tr>\n                            <tr>\n                                <td></td>\n                                <td>\n                                <Tooltip placement=\"right\" title=\"Move Dowm\" arrowPointAtCenter>\n                                    <Button shape=\"round\" size=\"large\" icon={<ArrowDownOutlined />} onClick={() => this.sendMessage({actionType : \"mousedown\",action : \"down\"})}/>\n                                </Tooltip>\n                                    </td>\n                                <td></td>\n                                <td></td>\n                                <td><Input className=\"fpsInput\" defaultValue={30} value={frameRate} suffix=\"FPS\"/></td>\n                                <td>\n                                    <Tooltip placement=\"bottom\" title=\"Increase the FPS\" arrowPointAtCenter>\n                                        <Button shape=\"round\" size=\"large\" icon={<UpOutlined />} onClick={() => this.handleFPS(\"faster\")}/>\n                                    </Tooltip>\n                                    <Tooltip placement=\"bottom\" title=\"Decrease the FPS\" arrowPointAtCenter>\n                                        <Button shape=\"round\" size=\"large\" icon={<DownOutlined />} onClick={() => this.handleFPS(\"slower\")}/>\n                                    </Tooltip>\n                                </td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        )}\n}\n\nexport default Game;\n"]},"metadata":{},"sourceType":"module"}